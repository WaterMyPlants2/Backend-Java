<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: LogoutController</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
  <div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">com.lambda.watermyplants.controllers</a> ]
  </div>

  <h1>Coverage Summary for Class: LogoutController (com.lambda.watermyplants.controllers)</h1>

  <table class="coverageStats">
    <tr>
      <th class="name">Class</th>
      <th class="coverageStat
">
        Class, %
      </th>
      <th class="coverageStat
">
        Method, %
      </th>
      <th class="coverageStat
">
        Line, %
      </th>
    </tr>
    <tr>
      <td class="name">LogoutController</td>
      <td class="coverageStat">
  <span class="percent">
    100%
  </span>
        <span class="absValue">
    (1/ 1)
  </span>
      </td>
      <td class="coverageStat">
  <span class="percent">
    50%
  </span>
        <span class="absValue">
    (1/ 2)
  </span>
      </td>
      <td class="coverageStat">
  <span class="percent">
    12.5%
  </span>
        <span class="absValue">
    (1/ 8)
  </span>
      </td>
    </tr>

  </table>

  <br/>
  <br/>


  <div class="sourceCode"><i>1</i>&nbsp;package com.lambda.watermyplants.controllers;
    <i>2</i>&nbsp;
    <i>3</i>&nbsp;import io.swagger.annotations.ApiOperation;
    <i>4</i>&nbsp;import org.springframework.beans.factory.annotation.Autowired;
    <i>5</i>&nbsp;import org.springframework.http.HttpStatus;
    <i>6</i>&nbsp;import org.springframework.security.oauth2.common.OAuth2AccessToken;
    <i>7</i>&nbsp;import org.springframework.security.oauth2.provider.token.TokenStore;
    <i>8</i>&nbsp;import org.springframework.stereotype.Controller;
    <i>9</i>&nbsp;import org.springframework.web.bind.annotation.RequestMapping;
    <i>10</i>&nbsp;import org.springframework.web.bind.annotation.RequestMethod;
    <i>11</i>&nbsp;import org.springframework.web.bind.annotation.ResponseStatus;
    <i>12</i>&nbsp;
    <i>13</i>&nbsp;import javax.servlet.http.HttpServletRequest;
    <i>14</i>&nbsp;
    <i>15</i>&nbsp;/**
    <i>16</i>&nbsp; * The application implements its own logout endpoint. This works by removing the authentication
    token for the user.
    <i>17</i>&nbsp; */
    <i>18</i>&nbsp;@Controller
    <b class="fc"><i>19</i>&nbsp;public class LogoutController {</b>
    <i>20</i>&nbsp; /**
    <i>21</i>&nbsp; * Connect to the Token store so the application can remove the token
    <i>22</i>&nbsp; */
    <i>23</i>&nbsp; @Autowired
    <i>24</i>&nbsp; private TokenStore tokenStore;
    <i>25</i>&nbsp;
    <i>26</i>&nbsp; /**
    <i>27</i>&nbsp; * Removes the token for the signed on user. The signed user will lose access to the application.
    They would have to sign on again.
    <i>28</i>&nbsp; *
    <i>29</i>&nbsp; * &lt;br&gt;Example: &lt;a href=&quot;http://localhost:8080/api/auth/logout&quot;&gt;http://localhost:8080/api/auth/logout&lt;/a&gt;
    <i>30</i>&nbsp; *
    <i>31</i>&nbsp; * @param request the Http request from which we find the authorization header which includes the
    token to be removed
    <i>32</i>&nbsp; */
    <i>33</i>&nbsp; // yes, both endpoints are mapped to the same Java method! So, either one will work.
    <i>34</i>&nbsp; @ApiOperation(value = &quot;revoke current user&#39;s token&quot;, response = void.class)
    <i>35</i>&nbsp; @RequestMapping(value = {&quot;/oauth/revoke-token&quot;, &quot;/api/auth/logout&quot;},
    <i>36</i>&nbsp; method = RequestMethod.GET)
    <i>37</i>&nbsp; @ResponseStatus(HttpStatus.OK)
    <i>38</i>&nbsp; public void logoutSelf(HttpServletRequest request) {
    <b class="nc"><i>39</i>&nbsp; String authHeader = request.getHeader(&quot;Authorization&quot;);</b>
    <b class="nc"><i>40</i>&nbsp; if (authHeader != null) {</b>
    <i>41</i>&nbsp; // find the token
    <b class="nc"><i>42</i>&nbsp; String tokenValue = authHeader.replace(&quot;Bearer&quot;,</b>
    <i>43</i>&nbsp; &quot;&quot;)
    <b class="nc"><i>44</i>&nbsp; .trim();</b>
    <i>45</i>&nbsp; // and remove it!
    <b class="nc"><i>46</i>&nbsp; OAuth2AccessToken accessToken = tokenStore.readAccessToken(tokenValue);</b>
    <b class="nc"><i>47</i>&nbsp; tokenStore.removeAccessToken(accessToken);</b>
    <i>48</i>&nbsp; }
    <b class="nc"><i>49</i>&nbsp; }</b>
    <i>50</i>&nbsp;}
  </div>
</div>

<div class="footer">

  <div style="float:right;">generated on 2020-06-23 22:53</div>
</div>
</body>
</html>
